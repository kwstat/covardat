<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R-side structures in SAS, nlme, asreml • covardat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R-side structures in SAS, nlme, asreml">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covardat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/r-side.html">R-side structures in SAS, nlme, asreml</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>R-side structures in SAS, nlme, asreml</h1>
                        <h4 class="author">Kevin Wright</h4>
            
            <h4 class="date">2019-09-19</h4>
      
      
      <div class="hidden name"><code>r-side.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>Alzheimer’s patients were randomized to one of three treatments (Low, High, Placebo). Each patient was given a cognitive evaluation every two months during the year using the Alzheimer’s Disease Assessment Scale (ADAS). The cognitive scores range from 0 to 70, higher values indicate greater severity of the disease.</p>
<p>Note: this is a re-working of Example 8.3, Disease Progression in Alzheimer’s Trial, found in <span class="citation">Walker and Shostack (2010)</span>.</p>
</div>
<div id="r-setup" class="section level1">
<h1 class="hasAnchor">
<a href="#r-setup" class="anchor"></a>R setup</h1>
<p>First, attach necessary packages, source in the R code for the <code>rmat()</code> functions, and read in the data in the wide-format shown in the SAS book.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(asreml)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(covardat)</a></code></pre></div>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>The data is found in the <code>covardat</code> package. The <code>nlme</code> function works much more smoothly with a <code>groupedData</code> object, so create that too.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(alzheimers)</a>
<a class="sourceLine" id="cb2-2" title="2">dat &lt;-<span class="st"> </span>alzheimers</a>
<a class="sourceLine" id="cb2-3" title="3">dat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/transform.html">transform</a></span>(dat, <span class="dt">patient=</span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(patient),</a>
<a class="sourceLine" id="cb2-4" title="4">                 <span class="dt">month=</span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(month))</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(nlme)</a></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">datg &lt;-<span class="st"> </span><span class="kw">groupedData</span>(score <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(month)<span class="op">|</span>patient, <span class="dt">data=</span>dat)</a></code></pre></div>
<p>In the following plot, each line represents one patient, and shows the change in cognitive score over time.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(lattice)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">xyplot</span>(score <span class="op">~</span><span class="st"> </span>month<span class="op">|</span>trt , <span class="dt">data=</span>dat, <span class="dt">groups=</span>patient,</a>
<a class="sourceLine" id="cb5-3" title="3">             <span class="dt">xlab=</span><span class="st">"month"</span>, <span class="dt">ylab=</span><span class="st">"ADAS cognitive score"</span>, <span class="dt">type=</span><span class="st">'l'</span>,<span class="dt">layout=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb5-4" title="4">             <span class="dt">scales=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">x=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">rot=</span><span class="dv">90</span>, <span class="dt">cex=</span>.<span class="dv">75</span>, <span class="dt">alternating=</span><span class="ot">FALSE</span>)))</a></code></pre></div>
<p><img src="r-side_files/figure-html/plotraw-1.png" width="700"></p>
<p>The following scatterplot matrix will provide some guidance for models. Each point represents one patient. The correlation of observed values is much higher for months that are adjacent than for months that are farther apart. It is this correlation which can be captured in a model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(reshape2)</a></code></pre></div>
<pre><code>## Loading required package: reshape2</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">datw &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/reshape2/man/cast.html">acast</a></span>(dat, patient<span class="op">~</span>month)</a></code></pre></div>
<pre><code>## Using score as value column: use value.var to override.</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">splom</span>(<span class="op">~</span>datw, <span class="dt">cex=</span>.<span class="dv">5</span>, <span class="dt">varname.cex=</span>.<span class="dv">75</span>,</a>
<a class="sourceLine" id="cb10-2" title="2">      <span class="dt">axis.text.cex=</span>.<span class="dv">5</span>, <span class="dt">axis.line.tck=</span><span class="dv">0</span>)</a></code></pre></div>
<p><img src="r-side_files/figure-html/splom-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## require(corrgram)</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">## corrgram(datw, upper.panel=panel.pts, lower.panel=panel.cor)</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">## title("alzheimers")</span></a></code></pre></div>
</div>
<div id="uniform-correlation-compound-symmetry" class="section level1">
<h1 class="hasAnchor">
<a href="#uniform-correlation-compound-symmetry" class="anchor"></a>Uniform Correlation, Compound Symmetry</h1>
<p>In the compound symmetry (also called uniform correlation), all off-diagonal elements of the correlation matrix have the same value.</p>
<div id="compound-symmetry---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-symmetry---sas" class="anchor"></a>Compound Symmetry - SAS</h2>
<pre><code>PROC MIXED;
CLASS trt month patient;
MODEL score = trt month trt*month;
repeated / subject=patient(trt) type=cs rcorr;

   Estimated R Correlation Matrix for patient(treat)
 Row      Col1     Col2     Col3     Col4     Col5     Col6 
   1    1.0000   0.8038   0.8038   0.8038   0.8038   0.8038 
   2    0.8038   1.0000   0.8038   0.8038   0.8038   0.8038 
   3    0.8038   0.8038   1.0000   0.8038   0.8038   0.8038 
   4    0.8038   0.8038   0.8038   1.0000   0.8038   0.8038 
   5    0.8038   0.8038   0.8038   0.8038   1.0000   0.8038 
   6    0.8038   0.8038   0.8038   0.8038   0.8038   1.0000

  Covariance Parameter Estimates 
 
 Cov Parm     Subject       Estimate 
 CS           pat(treat)     64.6927 
 Residual                    15.7919
 </code></pre>
<p>The <code>RCORR</code> option tells SAS to print the R-side correlation matrix. Since each patient receives only one treatment and the patient numbers are unique, the <code>repeated</code> statement could be simplified to <code>subject = patient</code>, indicating that there are repeated measurements on each subject (i.e. patient).</p>
</div>
<div id="compound-symmetry---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-symmetry---nlme" class="anchor"></a>Compound Symmetry - nlme</h2>
<p>The <code>lme()</code> function requires the inclusion of random effects. Since this example has no random effects, the <code>gls()</code> function is used instead of <code>lme</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># CS - nlme</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co"># 'gls' needs a groupedData data.  Otherwise it shows only 5 columns in R</span></a>
<a class="sourceLine" id="cb13-3" title="3">cs1 &lt;-<span class="st"> </span><span class="kw">gls</span>(score <span class="op">~</span><span class="st"> </span>trt <span class="op">*</span><span class="st"> </span>month, <span class="dt">data=</span>datg,</a>
<a class="sourceLine" id="cb13-4" title="4">           <span class="dt">correlation=</span><span class="kw">corCompSymm</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>patient),</a>
<a class="sourceLine" id="cb13-5" title="5">           <span class="dt">na.action=</span>na.omit)</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span>(cs1)<span class="op">*</span><span class="dv">2</span> <span class="co"># match to SAS</span></a></code></pre></div>
<pre><code>## 'log Lik.' -2743.479 (df=20)</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span>(cs1) <span class="co"># similar to SAS</span></a></code></pre></div>
<pre><code>## Denom. DF: 436 
##             numDF   F-value p-value
## (Intercept)     1 1509.5778  &lt;.0001
## trt             2    0.8429  0.4312
## month           5   28.2073  &lt;.0001
## trt:month      10    2.3011  0.0122</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># summary(cs1) # Too much output</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cs1<span class="op">$</span>modelStruct<span class="op">$</span>corStruct)</a></code></pre></div>
<pre><code>## Correlation Structure: Compound symmetry
##  Formula: ~1 | patient 
##  Parameter estimate(s):
##      Rho 
## 0.803791</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># cs1$sigma^2 * .8038 = 64.69 # SAS scaling</span></a></code></pre></div>
<p>For any patient, the correlation of observations at (any) two times is about 0.80.</p>
<p>In order to make this a bit more clear, the <code><a href="../reference/rcor-methods.html">rcor()</a></code> function was created to print the R matrix (similar to <code>RCORR</code> option in SAS). The <code><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid()</a></code> function is used to simplify interpretation.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(lucid)</a></code></pre></div>
<pre><code>## Loading required package: lucid</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(cs1)))</a></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4]  [,5]  [,6] 
## [1,] 1     0.804 0.804 0.804 0.804 0.804
## [2,] 0.804 1     0.804 0.804 0.804 0.804
## [3,] 0.804 0.804 1     0.804 0.804 0.804
## [4,] 0.804 0.804 0.804 1     0.804 0.804
## [5,] 0.804 0.804 0.804 0.804 1     0.804
## [6,] 0.804 0.804 0.804 0.804 0.804 1</code></pre>
</div>
<div id="compound-symmetry---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-symmetry---asreml" class="anchor"></a>Compound Symmetry - asreml</h2>
<p>In contrast to <code>SAS</code> and <code>lme()</code>, <code>asreml()</code> requires the specification of the full residual matrix in the <code>rcov</code> argument. The term <code>patient:cor(month)</code> is shorthand notation for an identity matrix (of size equal to the number of patients), direct-product with a uniform correlation matrix for month,</p>
<p><span class="math display">\[
R = I \otimes C_{\mbox{month}}
\]</span></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="co"># CS - asreml</span></a>
<a class="sourceLine" id="cb24-2" title="2">dat &lt;-<span class="st"> </span>dat[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(dat<span class="op">$</span>patient, dat<span class="op">$</span>month), ]</a>
<a class="sourceLine" id="cb24-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(asreml)</a>
<a class="sourceLine" id="cb24-4" title="4">cs2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt <span class="op">*</span><span class="st"> </span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb24-5" title="5">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(month), <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb24-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cs2)<span class="op">$</span>varcomp</a></code></pre></div>
<pre><code>##                gamma component   std.error   z.ratio    constraint
## R!variance  1.000000 80.485103 10.92939077  7.364098      Positive
## R!month.cor 0.803791  0.803791  0.02925262 27.477568 Unconstrained</code></pre>
<p>The estimated correlation from asreml is the same as from lme. Internally, asreml stores the estimated parameters of the R matrix as a list, each item in the list representing one of the direct-product terms specified by <code>rcov</code>. To understand this more clearly, the following code uses <code><a href="../reference/rcor-methods.html">rcor()</a></code> to format the estimated parameters as a matrix. A dedicated print method for this object shows the formula and prints the upper-left corner of each matrix.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(lucid)</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(cs2)</a></code></pre></div>
<pre><code>## ~patient:cor(month)
## patient [1:6] :
##   1 2 3 4 5 6
## 1 1 0 0 0 0 0
## 2 0 1 0 0 0 0
## 3 0 0 1 0 0 0
## 4 0 0 0 1 0 0
## 5 0 0 0 0 1 0
## 6 0 0 0 0 0 1
## month:
##    2     4     6     8     10    12   
## 2  1     0.804 0.804 0.804 0.804 0.804
## 4  0.804 1     0.804 0.804 0.804 0.804
## 6  0.804 0.804 1     0.804 0.804 0.804
## 8  0.804 0.804 0.804 1     0.804 0.804
## 10 0.804 0.804 0.804 0.804 1     0.804
## 12 0.804 0.804 0.804 0.804 0.804 1    
## variance:
## [1] 1</code></pre>
<p>The correlation matrix just for ‘month’ can be shown this way.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(cs2)<span class="op">$</span>month))</a></code></pre></div>
<pre><code>##    2     4     6     8     10    12   
## 2  1     0.804 0.804 0.804 0.804 0.804
## 4  0.804 1     0.804 0.804 0.804 0.804
## 6  0.804 0.804 1     0.804 0.804 0.804
## 8  0.804 0.804 0.804 1     0.804 0.804
## 10 0.804 0.804 0.804 0.804 1     0.804
## 12 0.804 0.804 0.804 0.804 0.804 1</code></pre>
</div>
</div>
<div id="ar1" class="section level1">
<h1 class="hasAnchor">
<a href="#ar1" class="anchor"></a>AR1</h1>
<p>The auto-regressive model has only one parameter to estimate, but the form of the correlation matrix is an exponential decay in the correlation as the time between two observations increases.</p>
<div id="ar1---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#ar1---sas" class="anchor"></a>AR1 - SAS</h2>
<pre><code>PROC MIXED;
CLASS trt month patient;
MODEL score = trt month trt*month;
repeated / subject=patient(trt) type=ar(1);

        Type 3 Tests of Fixed Effects
               Num     Den
Effect           DF      DF    F Value    Pr &gt; F
trt               2      77       0.94    0.3952
month             5     359      11.21    &lt;.0001
trt*month        10     359       1.43    0.1671</code></pre>
</div>
<div id="ar1---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#ar1---nlme" class="anchor"></a>AR1 - nlme</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># nlme</span></a>
<a class="sourceLine" id="cb31-2" title="2">ar1 &lt;-<span class="st"> </span><span class="kw">gls</span>(score <span class="op">~</span><span class="st"> </span>trt <span class="op">*</span><span class="st"> </span>month, <span class="dt">data=</span>datg,</a>
<a class="sourceLine" id="cb31-3" title="3">           <span class="dt">correlation=</span><span class="kw">corAR1</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>patient),</a>
<a class="sourceLine" id="cb31-4" title="4">           <span class="dt">na.action=</span>na.omit)</a>
<a class="sourceLine" id="cb31-5" title="5"><span class="kw"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span>(ar1)</a></code></pre></div>
<pre><code>## Denom. DF: 436 
##             numDF   F-value p-value
## (Intercept)     1 1569.2752  &lt;.0001
## trt             2    1.0145  0.3634
## month           5   11.8304  &lt;.0001
## trt:month      10    1.4784  0.1445</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co">#summary(ar1)</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ar1<span class="op">$</span>modelStruct<span class="op">$</span>corStruct)</a></code></pre></div>
<pre><code>## Correlation Structure: AR(1)
##  Formula: ~1 | patient 
##  Parameter estimate(s):
##       Phi 
## 0.8757637</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(ar1), <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,] 1    0.88 0.77 0.67 0.59 0.52
## [2,] 0.88 1    0.88 0.77 0.67 0.59
## [3,] 0.77 0.88 1    0.88 0.77 0.67
## [4,] 0.67 0.77 0.88 1    0.88 0.77
## [5,] 0.59 0.67 0.77 0.88 1    0.88
## [6,] 0.52 0.59 0.67 0.77 0.88 1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># cov2cor(getVarCov(ar1))</span></a></code></pre></div>
</div>
<div id="ar1---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#ar1---asreml" class="anchor"></a>AR1 - asreml</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># asreml</span></a>
<a class="sourceLine" id="cb38-2" title="2">ar2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt<span class="op">*</span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb38-3" title="3">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">ar1</span>(month), <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb38-4" title="4"><span class="kw"><a href="https://rdrr.io/pkg/lucid/man/vc.html">vc</a></span>(ar2)</a></code></pre></div>
<pre><code>##       effect component std.error z.ratio constr
##   R!variance   83.45    10.21        8.2      P
##  R!month.cor    0.8801   0.01593    55        U</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(ar2)<span class="op">$</span>month, <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  1    0.88 0.77 0.68 0.6  0.53
## 4  0.88 1    0.88 0.77 0.68 0.6 
## 6  0.77 0.88 1    0.88 0.77 0.68
## 8  0.68 0.77 0.88 1    0.88 0.77
## 10 0.6  0.68 0.77 0.88 1    0.88
## 12 0.53 0.6  0.68 0.77 0.88 1</code></pre>
</div>
</div>
<div id="factor-analytic" class="section level1">
<h1 class="hasAnchor">
<a href="#factor-analytic" class="anchor"></a>Factor Analytic</h1>
<p>The factor analytic model increases the number of parameters with a vector of loadings and variances.</p>
<div id="factor-analytic---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#factor-analytic---sas" class="anchor"></a>Factor Analytic - SAS</h2>
<p>Not included.</p>
</div>
<div id="factor-analytic---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#factor-analytic---nlme" class="anchor"></a>Factor Analytic - nlme</h2>
<p>Not included.</p>
</div>
<div id="factor-analytic---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#factor-analytic---asreml" class="anchor"></a>Factor Analytic - asreml</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># Factor analytic</span></a>
<a class="sourceLine" id="cb42-2" title="2">dat &lt;-<span class="st"> </span>dat[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(dat<span class="op">$</span>patient, dat<span class="op">$</span>month),]</a>
<a class="sourceLine" id="cb42-3" title="3">fa2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt<span class="op">*</span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb42-4" title="4">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">facv</span>(month,<span class="dv">1</span>), <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb42-5" title="5"><span class="kw"><a href="https://rdrr.io/pkg/lucid/man/vc.html">vc</a></span>(fa2)</a></code></pre></div>
<pre><code>##          effect component std.error z.ratio constr
##      R!variance     1            NA      NA      F
##   R!month.2.fa1     7.91     0.7664    10        U
##   R!month.4.fa1     7.381    0.7271    10        U
##   R!month.6.fa1     7.588    0.7336    10        U
##   R!month.8.fa1     8.607    0.7305    12        U
##  R!month.10.fa1     8.195    0.7808    10        U
##  R!month.12.fa1     8.566    0.8047    11        U
##   R!month.2.var    17.02     3.323      5.1      U
##   R!month.4.var    15.83     3.136      5        U
##   R!month.6.var    16.33     3.183      5.1      U
##   R!month.8.var    10.64     2.478      4.3      U
##  R!month.10.var    16.08     3.245      5        U
##  R!month.12.var    17.53     3.626      4.8      U</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(fa2)<span class="op">$</span>month, <span class="dt">dig=</span><span class="dv">3</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  79.6 58.4 60   68.1 64.8 67.8
## 4  58.4 70.3 56   63.5 60.5 63.2
## 6  60   56   73.9 65.3 62.2 65  
## 8  68.1 63.5 65.3 84.7 70.5 73.7
## 10 64.8 60.5 62.2 70.5 83.2 70.2
## 12 67.8 63.2 65   73.7 70.2 90.9</code></pre>
<p>Even though the extractor function is called <code><a href="../reference/rcor-methods.html">rcor()</a></code>, it is actually returning the covariance matrix, not the correlation matrix. Compare this to the pairwise covariance matrix of the observed data:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(datw, <span class="dt">use=</span><span class="st">"pair"</span>),<span class="dt">dig=</span><span class="dv">3</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  74   61.9 51.2 60.9 46.9 60.8
## 4  61.9 70.2 57.3 64.3 48.4 60.7
## 6  51.2 57.3 71.7 69.1 46.8 63.2
## 8  60.9 64.3 69.1 87.8 65.5 77.5
## 10 46.9 48.4 46.8 65.5 76.2 74.9
## 12 60.8 60.7 63.2 77.5 74.9 94.3</code></pre>
</div>
</div>
<div id="toeplitz-banded" class="section level1">
<h1 class="hasAnchor">
<a href="#toeplitz-banded" class="anchor"></a>Toeplitz, Banded</h1>
<div id="banded---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#banded---sas" class="anchor"></a>Banded - SAS</h2>
<pre><code>PROC MIXED;
CLASS trt month patient;
MODEL score = trt month trt*month;
repeated / subject=patient(trt) type=toep rcorr;</code></pre>
</div>
<div id="banded---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#banded---nlme" class="anchor"></a>Banded - nlme</h2>
<p>Not possible.</p>
</div>
<div id="banded---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#banded---asreml" class="anchor"></a>Banded - asreml</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="co"># TO - asreml.  This model is 'delicate' and might need help.</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="co"># Try starting values, rcov = ~ patient:corb(month, k=4, init=rep(.5,4)))</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="co"># Or: fit corb( , k=2) and then update the model to corb( , k=4)</span></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="co"># Or: fit cor(), then update to corb()</span></a>
<a class="sourceLine" id="cb49-5" title="5">to2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt<span class="op">*</span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb49-6" title="6">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">corb</span>(month, <span class="dt">k=</span><span class="dv">4</span>, <span class="dt">init=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.<span class="dv">5</span>,<span class="dv">4</span>)),</a>
<a class="sourceLine" id="cb49-7" title="7">              <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb49-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(to2)<span class="op">$</span>month, <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  1    0.81 0.6  0.42 0.19 0   
## 4  0.81 1    0.81 0.6  0.42 0.19
## 6  0.6  0.81 1    0.81 0.6  0.42
## 8  0.42 0.6  0.81 1    0.81 0.6 
## 10 0.19 0.42 0.6  0.81 1    0.81
## 12 0    0.19 0.42 0.6  0.81 1</code></pre>
</div>
</div>
<div id="antedependence" class="section level1">
<h1 class="hasAnchor">
<a href="#antedependence" class="anchor"></a>Antedependence</h1>
<p>Variates observed at successive times are said to have an antedependence structure of order r if each ith variate (i&gt;r), given the preceding r, is independent of all further preceding variates. The antedependence model is designed to be close to the unstructured model, and involves far fewer parameters. The covariance matrix for the antedependence structure C is defined as a function of a diagonal matrix D and a matrix U which has elements all zero apart from the diagonal elements (which are all 1) and, for the order 1 structure, one off diagonal element. For an order 2 structure, U has two off diagonal elements. Specifically, <span class="math inline">\(C = (U D^{-1} U' )^{-1}\)</span>. Asreml produces the diagonal elements of <span class="math inline">\(D^{-1}\)</span> and the non-zero elements of U.</p>
<div id="antedependence---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#antedependence---sas" class="anchor"></a>Antedependence - SAS</h2>
<pre><code>PROC MIXED;
CLASS trt month patient;
MODEL score = trt month trt*month;
repeated / subject=patient(trt) type=ante rcorr;</code></pre>
</div>
<div id="antedependence---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#antedependence---nlme" class="anchor"></a>Antedependence - nlme</h2>
<p>Not possible.</p>
</div>
<div id="antedependence---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#antedependence---asreml" class="anchor"></a>Antedependence - asreml</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">dat &lt;-<span class="st"> </span>dat[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(dat<span class="op">$</span>patient, dat<span class="op">$</span>month),]</a>
<a class="sourceLine" id="cb52-2" title="2">an2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt<span class="op">*</span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb52-3" title="3">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">ante</span>(month, <span class="dv">1</span>), <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb52-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(an2)<span class="op">$</span>month, <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  1    0.9  0.74 0.65 0.56 0.51
## 4  0.9  1    0.82 0.72 0.62 0.57
## 6  0.74 0.82 1    0.87 0.75 0.69
## 8  0.65 0.72 0.87 1    0.86 0.79
## 10 0.56 0.62 0.75 0.86 1    0.92
## 12 0.51 0.57 0.69 0.79 0.92 1</code></pre>
</div>
</div>
<div id="unstructured" class="section level1">
<h1 class="hasAnchor">
<a href="#unstructured" class="anchor"></a>Unstructured</h1>
<p>The most general correlation matrix allows for a separate correlation between each pair of months.</p>
<div id="unstructured---sas" class="section level2">
<h2 class="hasAnchor">
<a href="#unstructured---sas" class="anchor"></a>Unstructured - SAS</h2>
<pre><code>PROC MIXED;
CLASS trt month patient;
MODEL score = trt month trt*month;
repeated / type=un subject=patient(trt) rcorr;

  PROC MIXED Using Unstructured Covariance (UN)
        Type 3 Tests of Fixed Effects
                Num     Den
Effect           DF      DF    F Value    Pr &gt; F
trt               2      77       0.94    0.3967
month             5      77      21.55    &lt;.0001
trt*month        10      77       2.08    0.0357

  Estimated R Correlation Matrix for patient(treat)
 Row       Col1     Col2     Col3     Col4     Col5     Col6 
   1     1.0000   0.9005   0.7703   0.8002   0.7763   0.7773 
   2     0.9005   1.0000   0.8179   0.7995   0.7521   0.7261 
   3     0.7703   0.8179   1.0000   0.8738   0.7223   0.7418 
   4     0.8002   0.7995   0.8738   1.0000   0.8628   0.8273 
   5     0.7763   0.7521   0.7223   0.8628   1.0000   0.9206 
   6     0.7773   0.7261   0.7418   0.8273   0.9206   1.0000 </code></pre>
</div>
<div id="unstructured---nlme" class="section level2">
<h2 class="hasAnchor">
<a href="#unstructured---nlme" class="anchor"></a>Unstructured - nlme</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="co"># UN nlme</span></a>
<a class="sourceLine" id="cb55-2" title="2">un1 &lt;-<span class="st"> </span><span class="kw">gls</span>(score <span class="op">~</span><span class="st"> </span>trt <span class="op">*</span><span class="st"> </span>month, <span class="dt">data=</span>datg,</a>
<a class="sourceLine" id="cb55-3" title="3">           <span class="dt">correlation=</span><span class="kw">corSymm</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>patient),</a>
<a class="sourceLine" id="cb55-4" title="4">           <span class="dt">na.action=</span>na.omit)</a>
<a class="sourceLine" id="cb55-5" title="5"><span class="kw"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span>(un1)<span class="op">*</span><span class="dv">2</span> <span class="co"># DOES NOT match SAS</span></a></code></pre></div>
<pre><code>## 'log Lik.' -2657.776 (df=34)</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span>(un1)</a></code></pre></div>
<pre><code>## Denom. DF: 436 
##             numDF   F-value p-value
## (Intercept)     1 1560.5016  &lt;.0001
## trt             2    0.9554  0.3855
## month           5   23.3903  &lt;.0001
## trt:month      10    2.1315  0.0211</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(un1), <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,] 1    0.9  0.79 0.8  0.79 0.75
## [2,] 0.9  1    0.84 0.8  0.76 0.68
## [3,] 0.79 0.84 1    0.87 0.73 0.71
## [4,] 0.8  0.8  0.87 1    0.86 0.8 
## [5,] 0.79 0.76 0.73 0.86 1    0.91
## [6,] 0.75 0.68 0.71 0.8  0.91 1</code></pre>
</div>
<div id="unstructured---asreml" class="section level2">
<h2 class="hasAnchor">
<a href="#unstructured---asreml" class="anchor"></a>Unstructured - asreml</h2>
<p>In asreml, a general correlation matrix (with arbitrary off-diagonal elements) is specified with <code>corg</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="co"># UN asreml.  Need starting values to get convergence</span></a>
<a class="sourceLine" id="cb61-2" title="2">un2 &lt;-<span class="st"> </span><span class="kw">asreml</span>(score <span class="op">~</span><span class="st"> </span>trt <span class="op">*</span><span class="st"> </span>month, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb61-3" title="3">              <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">corg</span>(month, <span class="dt">init=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.<span class="dv">8</span>,<span class="dv">15</span>)),</a>
<a class="sourceLine" id="cb61-4" title="4">              <span class="dt">trace=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb61-5" title="5"><span class="kw"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span>(un2)</a></code></pre></div>
<pre><code>## Wald tests for fixed effects
## 
## Response: score
## 
## Terms added sequentially; adjusted for those above
## 
##               Df Sum of Sq Wald statistic Pr(Chisq)    
## (Intercept)    1    124476        1545.37   &lt; 2e-16 ***
## trt            2       108           1.33   0.51309    
## month          5      9308         115.57   &lt; 2e-16 ***
## trt:month     10      1703          21.14   0.02013 *  
## residual (MS)           81                             
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/noquote.html">noquote</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/lucid/man/lucid.html">lucid</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(un2)<span class="op">$</span>month, <span class="dt">dig=</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##    2    4    6    8    10   12  
## 2  1    0.9  0.78 0.8  0.77 0.77
## 4  0.9  1    0.83 0.8  0.75 0.72
## 6  0.78 0.83 1    0.87 0.71 0.73
## 8  0.8  0.8  0.87 1    0.85 0.82
## 10 0.77 0.75 0.71 0.85 1    0.91
## 12 0.77 0.72 0.73 0.82 0.91 1</code></pre>
<p>Note that in this example, it was necessary to specify starting values in order for asreml to converge. Ideally, the strategy would be to fit a simpler model, such as the uniform correlation model, and then update to the full model. Something like</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">un2a &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(cs2, <span class="dt">rcov =</span> <span class="op">~</span><span class="st"> </span>patient<span class="op">:</span><span class="kw">corg</span>(month))</a></code></pre></div>
<p>Unfortunately, this did not work.</p>
</div>
<div id="comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison" class="anchor"></a>Comparison</h2>
<p>All models can be compared using the <code><a href="https://rdrr.io/r/stats/AIC.html">AIC()</a></code> function, but we need to define a <code><a href="https://rdrr.io/r/stats/logLik.html">logLik()</a></code> method for <code>asreml()</code> objects.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">logLik.asreml &lt;-<span class="st"> </span><span class="cf">function</span>(object,...){</a>
<a class="sourceLine" id="cb66-2" title="2">  <span class="co"># Kevin Wright</span></a>
<a class="sourceLine" id="cb66-3" title="3"></a>
<a class="sourceLine" id="cb66-4" title="4">  val &lt;-<span class="st"> </span>object<span class="op">$</span>loglik</a>
<a class="sourceLine" id="cb66-5" title="5"></a>
<a class="sourceLine" id="cb66-6" title="6">  <span class="co"># Note that object$gammas includes parameters fixed at 1.0 and therefore</span></a>
<a class="sourceLine" id="cb66-7" title="7">  <span class="co"># length(object$gammas) is NOT the number of parameters.  Instead, look</span></a>
<a class="sourceLine" id="cb66-8" title="8">  <span class="co"># at object$gammas.con to see how many non-fixed parameters there are.</span></a>
<a class="sourceLine" id="cb66-9" title="9">  <span class="co"># Fixed parameters are denoted by code '4'.</span></a>
<a class="sourceLine" id="cb66-10" title="10">  p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(object<span class="op">$</span>gammas.con<span class="op">!=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb66-11" title="11">  <span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(val,<span class="st">"df"</span>) &lt;-<span class="st"> </span>p</a>
<a class="sourceLine" id="cb66-12" title="12"></a>
<a class="sourceLine" id="cb66-13" title="13">  <span class="co"># Note, for REML methods, nobs=N-p.  This does not seems to be the same</span></a>
<a class="sourceLine" id="cb66-14" title="14">  <span class="co"># as nedf (residual degrees of freedom), but when I use 'nedf' I am</span></a>
<a class="sourceLine" id="cb66-15" title="15">  <span class="co"># able to match the table of BIC values in the asreml manual (Chapter 11).</span></a>
<a class="sourceLine" id="cb66-16" title="16">  <span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(val,<span class="st">"nobs"</span>) &lt;-<span class="st"> </span>object<span class="op">$</span>nedf</a>
<a class="sourceLine" id="cb66-17" title="17">  <span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(val) &lt;-<span class="st"> "logLik"</span></a>
<a class="sourceLine" id="cb66-18" title="18">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(val)</a>
<a class="sourceLine" id="cb66-19" title="19">}</a>
<a class="sourceLine" id="cb66-20" title="20"></a>
<a class="sourceLine" id="cb66-21" title="21"><span class="kw"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span>(cs2, ar2, fa2, to2, an2, un2)</a></code></pre></div>
<pre><code>##     df      AIC
## cs2  2 1946.165
## ar2  2 1900.840
## fa2 12 1957.899
## to2  5 1961.419
## an2 11 1905.500
## un2 16 1884.605</code></pre>
<p>The smallest AIC value comes from the unstructured model.</p>
<p>To see visually how well the models capture the structure of the data, the observed and estimated correlations and covariances can be plotted. The correlation matrices all have the same scale. The covariance matrices have a common scale (different from the correlation matrices).</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">op &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb68-2" title="2"><span class="co"># Correlations</span></a>
<a class="sourceLine" id="cb68-3" title="3">RedGrayBlue &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"firebrick"</span>, <span class="st">"lightgray"</span>, <span class="st">"#375997"</span>))</a>
<a class="sourceLine" id="cb68-4" title="4"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(datw, <span class="dt">use=</span><span class="st">"pair"</span>), <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-5" title="5"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Raw correlation"</span>)</a>
<a class="sourceLine" id="cb68-6" title="6"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(cs2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-7" title="7"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Compound symmetry"</span>)</a>
<a class="sourceLine" id="cb68-8" title="8"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(ar2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-9" title="9"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Autoregressive"</span>)</a>
<a class="sourceLine" id="cb68-10" title="10"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(to2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-11" title="11"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Toeplitz"</span>)</a>
<a class="sourceLine" id="cb68-12" title="12"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(un2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-13" title="13"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Unstructured"</span>)</a>
<a class="sourceLine" id="cb68-14" title="14"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(an2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-15" title="15"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Antedependence"</span>)</a>
<a class="sourceLine" id="cb68-16" title="16"><span class="co"># Cov</span></a>
<a class="sourceLine" id="cb68-17" title="17"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span>(datw, <span class="dt">use=</span><span class="st">"pair"</span>), <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">45</span>,<span class="dv">95</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-18" title="18"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Raw data covariance"</span>)</a>
<a class="sourceLine" id="cb68-19" title="19"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw"><a href="../reference/rcor-methods.html">rcor</a></span>(fa2)<span class="op">$</span>month, <span class="dt">zlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">45</span>,<span class="dv">95</span>), <span class="dt">col=</span><span class="kw">RedGrayBlue</span>(<span class="dv">13</span>))</a>
<a class="sourceLine" id="cb68-20" title="20"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Factor analytic covariance"</span>)</a></code></pre></div>
<p><img src="r-side_files/figure-html/visual-1.png" width="720"></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</a></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-walker2002">
<p>Walker, Glenn, and Jack Shostack. 2010. <em>Common Statistical Methods for Clinical Research with SAS Examples</em>. SAS publishing.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#abstract">Abstract</a></li>
      <li><a href="#r-setup">R setup</a></li>
      <li><a href="#data-preparation">Data preparation</a></li>
      <li>
<a href="#uniform-correlation-compound-symmetry">Uniform Correlation, Compound Symmetry</a><ul class="nav nav-pills nav-stacked">
<li><a href="#compound-symmetry---sas">Compound Symmetry - SAS</a></li>
      <li><a href="#compound-symmetry---nlme">Compound Symmetry - nlme</a></li>
      <li><a href="#compound-symmetry---asreml">Compound Symmetry - asreml</a></li>
      </ul>
</li>
      <li>
<a href="#ar1">AR1</a><ul class="nav nav-pills nav-stacked">
<li><a href="#ar1---sas">AR1 - SAS</a></li>
      <li><a href="#ar1---nlme">AR1 - nlme</a></li>
      <li><a href="#ar1---asreml">AR1 - asreml</a></li>
      </ul>
</li>
      <li>
<a href="#factor-analytic">Factor Analytic</a><ul class="nav nav-pills nav-stacked">
<li><a href="#factor-analytic---sas">Factor Analytic - SAS</a></li>
      <li><a href="#factor-analytic---nlme">Factor Analytic - nlme</a></li>
      <li><a href="#factor-analytic---asreml">Factor Analytic - asreml</a></li>
      </ul>
</li>
      <li>
<a href="#toeplitz-banded">Toeplitz, Banded</a><ul class="nav nav-pills nav-stacked">
<li><a href="#banded---sas">Banded - SAS</a></li>
      <li><a href="#banded---nlme">Banded - nlme</a></li>
      <li><a href="#banded---asreml">Banded - asreml</a></li>
      </ul>
</li>
      <li>
<a href="#antedependence">Antedependence</a><ul class="nav nav-pills nav-stacked">
<li><a href="#antedependence---sas">Antedependence - SAS</a></li>
      <li><a href="#antedependence---nlme">Antedependence - nlme</a></li>
      <li><a href="#antedependence---asreml">Antedependence - asreml</a></li>
      </ul>
</li>
      <li>
<a href="#unstructured">Unstructured</a><ul class="nav nav-pills nav-stacked">
<li><a href="#unstructured---sas">Unstructured - SAS</a></li>
      <li><a href="#unstructured---nlme">Unstructured - nlme</a></li>
      <li><a href="#unstructured---asreml">Unstructured - asreml</a></li>
      <li><a href="#comparison">Comparison</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
